<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anagram-JS</title>
  <link rel="icon" href="assets/favicon.ico">

  <!-- Inline CSS -->
  <style>
    body {
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 2rem;
      background-color: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #2d89ef;
      margin-bottom: 1rem;
    }
    .logo {
      max-width: 150px;
      margin-bottom: 2rem;
    }
    #game-container {
      display: none;
    }
    #game-container.active {
      display: block;
    }
    #input-form {
      margin-bottom: 2rem;
    }
    #input-string {
      padding: 0.5rem;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
      width: 300px;
      background-color: #2d2d2d;
      color: #d4d4d4;
      border: 1px solid #3e3e3e;
    }
    #start-btn {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
      background-color: #2d89ef;
      color: white;
      border: none;
      cursor: pointer;
    }
    #start-btn:hover {
      background-color: #1e6fc9;
    }
    .game-display {
      margin: 2rem 0;
    }
    .letter-pool {
      font-size: 2rem;
      letter-spacing: 0.5rem;
      margin-bottom: 2rem;
      min-height: 3rem;
      color: #4ec9b0;
    }
    .anagram {
      font-size: 2rem;
      letter-spacing: 0.5rem;
      margin-bottom: 2rem;
      min-height: 3rem;
      color: #ce9178;
    }
    .controls {
      margin-top: 2rem;
      color: #858585;
      font-size: 0.9rem;
    }
    .saved-list {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #2d2d2d;
      border: 1px solid #3e3e3e;
      max-height: 200px;
      overflow-y: auto;
    }
    .saved-list h3 {
      margin-top: 0;
      color: #2d89ef;
      font-size: 1rem;
    }
    .saved-item {
      margin: 0.5rem 0;
      font-size: 0.9rem;
    }
    #new-game-btn {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
      background-color: #6a9955;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 1rem;
    }
    #new-game-btn:hover {
      background-color: #548242;
    }
  </style>
</head>
<body>
  <img src="assets/logo.png" alt="Logo" class="logo">
  <h1>I scramble, you match!</h1>

  <div id="input-form">
    <p>Enter a word or phrase to create anagrams:</p>
    <input type="text" id="input-string" placeholder="Enter text here" autofocus>
    <button id="start-btn">Start Game</button>
  </div>

  <div id="game-container">
    <div class="game-display">
      <div>Available letters:</div>
      <div class="letter-pool" id="letter-pool"></div>

      <div>Your anagram:</div>
      <div class="anagram" id="anagram"></div>
    </div>

    <div class="controls">
      <div>Press C to clear | Press S to save | Press Q to quit | Press SPACE to shuffle</div>
      <div>Type lowercase letters from the pool above to build your anagram</div>
      <div>Press BACKSPACE to undo the last letter</div>
    </div>

    <button id="new-game-btn">New Game</button>

    <div class="saved-list" id="saved-list-container" style="display: none;">
      <h3>Saved Anagrams</h3>
      <div id="saved-list"></div>
    </div>
  </div>

  <!-- Inline JavaScript -->
  <script>
    let originalString = '';
    let processedString = ''; // Lowercase, letters-only version for gameplay
    let availableLetters = '';
    let anagram = '';
    let savedAnagrams = [];

    const letterPoolEl = document.getElementById('letter-pool');
    const anagramEl = document.getElementById('anagram');
    const inputForm = document.getElementById('input-form');
    const gameContainer = document.getElementById('game-container');
    const inputString = document.getElementById('input-string');
    const startBtn = document.getElementById('start-btn');
    const newGameBtn = document.getElementById('new-game-btn');
    const savedListContainer = document.getElementById('saved-list-container');
    const savedListEl = document.getElementById('saved-list');

    function shuffle(str) {
      const arr = str.split('');
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr.join('');
    }

    function updateDisplay() {
      // Remove auto-shuffle - only shuffle manually with Space
      letterPoolEl.textContent = availableLetters || '(empty)';
      anagramEl.textContent = anagram || '(empty)';
    }

    function startGame() {
      const input = inputString.value.trim();
      if (!input) {
        alert('Please enter a word or phrase!');
        return;
      }

      originalString = input; // Keep original for display
      processedString = input.toLowerCase().replace(/[^a-z]/g, '');
      availableLetters = processedString;
      anagram = '';

      inputForm.style.display = 'none';
      gameContainer.classList.add('active');

      updateDisplay();
      document.addEventListener('keydown', handleKeyPress);
    }

    function resetGame() {
      availableLetters = processedString;
      anagram = '';
      updateDisplay();
    }

    function saveAnagram() {
      if (!anagram) {
        alert('No anagram to save!');
        return;
      }

      savedAnagrams.push({
        original: originalString,
        anagram: anagram,
        timestamp: new Date().toLocaleTimeString()
      });

      updateSavedList();
      alert('Anagram saved!');
    }

    function updateSavedList() {
      if (savedAnagrams.length === 0) {
        savedListContainer.style.display = 'none';
        return;
      }

      savedListContainer.style.display = 'block';
      savedListEl.innerHTML = savedAnagrams
        .map((item, index) =>
          `<div class="saved-item">${index + 1}. "${item.original}" â†’ "${item.anagram}" (${item.timestamp})</div>`
        )
        .join('');
    }

    function quitGame() {
      document.removeEventListener('keydown', handleKeyPress);
      gameContainer.classList.remove('active');
      inputForm.style.display = 'block';
      inputString.value = '';
      inputString.focus();
    }

    function handleKeyPress(e) {
      const key = e.key; // Don't convert to uppercase

      if (key === 'C') {           // Uppercase C = clear command
        e.preventDefault();
        resetGame();
      } else if (key === 'S') {    // Uppercase S = save command
        e.preventDefault();
        saveAnagram();
      } else if (key === 'Q') {    // Uppercase Q = quit command
        e.preventDefault();
        quitGame();
      } else if (key === ' ') {    // Space = shuffle command
        e.preventDefault();
        availableLetters = shuffle(availableLetters);
        letterPoolEl.textContent = availableLetters || '(empty)';
      } else if (key === 'Backspace') {  // Backspace = undo last letter
        e.preventDefault();
        if (anagram.length > 0) {
          const lastLetter = anagram[anagram.length - 1];
          anagram = anagram.slice(0, -1);
          availableLetters += lastLetter;
          letterPoolEl.textContent = availableLetters || '(empty)';
          anagramEl.textContent = anagram || '(empty)';
        }
      } else if (/^[a-z]$/.test(key)) {  // Only lowercase letters for anagram
        const index = availableLetters.indexOf(key);
        if (index !== -1) {
          anagram += key;
          availableLetters = availableLetters.slice(0, index) + availableLetters.slice(index + 1);
          letterPoolEl.textContent = availableLetters || '(empty)';
          anagramEl.textContent = anagram || '(empty)';
        }
      }
    }

    startBtn.addEventListener('click', startGame);
    newGameBtn.addEventListener('click', quitGame);

    inputString.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        startGame();
      }
    });

    console.log('Anagram game loaded at', new Date().toLocaleTimeString());
  </script>
</body>
</html>
